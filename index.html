<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Find Meow - TV ì±„ë„ ê³ ì–‘ì´ ì°¾ê¸° ê²Œì„</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="result-layout-patch.css">
</head>

<body>
    <!-- ë„ì›€ë§ ë²„íŠ¼ -->
    <button class="help-button" id="helpButton" onclick="openInfoPopup()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <circle cx="12" cy="17" r="0.5" fill="currentColor"></circle>
        </svg>
    </button>

    <!-- ê³ ì–‘ì´ ë°œìêµ­ ì• ë‹ˆë©”ì´ì…˜ ì»¨í…Œì´ë„ˆ -->
    <div class="paw-prints-container" id="pawPrintsContainer"></div>

    <!-- ë¡œê³  -->
    <div class="logo"><img src="images/logo.png" alt="FindMeow Logo"></div>

    <!-- TV í™”ë©´ -->
    <div class="tv-container">
        <div class="tv-screen" id="tvScreen">
            <img class="tv-image" id="tvImage" src="" alt="TV Screen">
            <div class="channel-display" id="channelDisplay">000</div>
            <div class="cat-counter" id="catCounter">0</div>
            <div class="tv-brand">CODA creaTV</div>
        </div>
    </div>

    <!-- ë²½ ì¥ì‹ ì˜ì—­ - ì‚¬ìš´ë“œë°” ìŠ¤í”¼ì»¤ -->
    <div class="wall-decoration-area">
        <div class="soundbar">
            <div class="soundbar-body">
                <!-- ì™¼ìª½ ìŠ¤í”¼ì»¤ ê·¸ë¦´ -->
                <div class="speaker-grill left">
                    <div class="grill-dots"></div>
                </div>

                <!-- ì¤‘ì•™ ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
                <div class="soundbar-center">
                    <button class="power-button" id="powerButton" onclick="toggleMusic()">
                        <div class="power-icon"></div>
                    </button>
                    <div class="led-indicator" id="ledIndicator"></div>
                    <div class="brand-label">SOUND</div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ìŠ¤í”¼ì»¤ ê·¸ë¦´ -->
                <div class="speaker-grill right">
                    <div class="grill-dots"></div>
                </div>
            </div>

            <!-- ì‚¬ìš´ë“œ ì›¨ì´ë¸Œ ì• ë‹ˆë©”ì´ì…˜ -->
            <div class="sound-waves" id="soundWaves">
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
            </div>
        </div>
    </div>

    <!-- ì´ˆê¸° í™”ë©´ (ì°¸ì—¬ ì¸ì› ì„ íƒ) -->
    <div class="initial-screen" id="initialScreen">
        <div class="input-group">
            <label for="playerCount">ì°¸ì—¬ ì¸ì› ìˆ˜</label>

            <!-- ë„¤ì´í‹°ë¸Œ select (ëª¨ë°”ì¼ìš©) -->
            <select id="playerCount" class="native-select">
                <option value="2">2ëª…</option>
                <option value="3" selected>3ëª…</option>
                <option value="4">4ëª…</option>
                <option value="5">5ëª…</option>
                <option value="6">6ëª…</option>
                <option value="7">7ëª…</option>
                <option value="8">8ëª…</option>
                <option value="9">9ëª…</option>
                <option value="10">10ëª…</option>
                <option value="11">11ëª…</option>
                <option value="12">12ëª…</option>
                <option value="13">13ëª…</option>
                <option value="14">14ëª…</option>
                <option value="15">15ëª…</option>
            </select>

            <!-- ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ (ë°ìŠ¤í¬í†±ìš©) -->
            <div class="custom-dropdown" id="customDropdown">
                <button type="button" class="custom-dropdown-button" id="dropdownButton">
                    <span id="dropdownValue">3ëª…</span>
                    <svg class="dropdown-arrow" width="12" height="8" viewBox="0 0 12 8">
                        <path fill="currentColor" d="M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z" />
                    </svg>
                </button>
                <div class="custom-dropdown-list" id="dropdownList">
                    <div class="custom-dropdown-option" data-value="2">2ëª…</div>
                    <div class="custom-dropdown-option" data-value="3">3ëª…</div>
                    <div class="custom-dropdown-option" data-value="4">4ëª…</div>
                    <div class="custom-dropdown-option" data-value="5">5ëª…</div>
                    <div class="custom-dropdown-option" data-value="6">6ëª…</div>
                    <div class="custom-dropdown-option" data-value="7">7ëª…</div>
                    <div class="custom-dropdown-option" data-value="8">8ëª…</div>
                    <div class="custom-dropdown-option" data-value="9">9ëª…</div>
                    <div class="custom-dropdown-option" data-value="10">10ëª…</div>
                    <div class="custom-dropdown-option" data-value="11">11ëª…</div>
                    <div class="custom-dropdown-option" data-value="12">12ëª…</div>
                    <div class="custom-dropdown-option" data-value="13">13ëª…</div>
                    <div class="custom-dropdown-option" data-value="14">14ëª…</div>
                    <div class="custom-dropdown-option" data-value="15">15ëª…</div>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    </div>

    <!-- ë¦¬ëª¨ì»¨ ì˜ì—­ -->
    <div class="remote-control" id="remoteControl">
        <div class="remote-header">
            <div class="player-info" id="playerInfo">í”Œë ˆì´ì–´ 1 / 3</div>
        </div>

        <input type="text" class="name-input" id="playerName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">

        <div class="number-pad">
            <button class="number-btn" id="btn1" onclick="pressNumber('1')">1</button>
            <button class="number-btn" id="btn2" onclick="pressNumber('2')">2</button>
            <button class="number-btn" id="btn3" onclick="pressNumber('3')">3</button>
            <button class="number-btn" id="btn4" onclick="pressNumber('4')">4</button>
            <button class="number-btn" id="btn5" onclick="pressNumber('5')">5</button>
            <button class="number-btn" id="btn6" onclick="pressNumber('6')">6</button>
            <button class="number-btn" id="btn7" onclick="pressNumber('7')">7</button>
            <button class="number-btn" id="btn8" onclick="pressNumber('8')">8</button>
            <button class="number-btn" id="btn9" onclick="pressNumber('9')">9</button>
            <button class="number-btn" id="btnBackspace" onclick="backspace()">âŒ«</button>
            <button class="number-btn" id="btn0" onclick="pressNumber('0')">0</button>
            <button class="number-btn channel-change" id="btnChannel" onclick="changeChannel()">ì±„ë„<br>ë³€ê²½</button>
        </div>

        <button class="btn-next" id="btnNext" onclick="confirmPlayer()" disabled>ë‹¤ìŒ</button>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="result-screen" id="resultScreen">
        <h2>ê²Œì„ ê²°ê³¼</h2>
        <div id="resultList"></div>
        <button class="btn btn-primary" onclick="resetGame()">ê´‘ê³ ë³´ê³  ë‹¤ì‹œë„ì „</button>
    </div>

    <!-- ê²Œì„ ì •ë³´ íŒì—… -->
    <div class="info-popup" id="infoPopup">
        <div class="info-popup-content">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button class="close-button" onclick="closeInfoPopup()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                    stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- ë“±ê¸‰ ë¶„ë¥˜ -->
            <div class="rating-section">
                <div class="rating-badge">
                    <div class="rating-icon">ì „ì²´</div>
                    <div class="rating-text">ì „ì²´ ì´ìš©ê°€</div>
                </div>
                <p class="rating-description">ë³¸ ê²Œì„ì€ ììœ¨ ë“±ê¸‰ ë¶„ë¥˜ì— ë”°ë¼ ëª¨ë“  ì—°ë ¹ì´ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- ê²Œì„ ì œëª© -->
            <h2 class="info-title">Find Meow</h2>
            <p class="info-subtitle">TV ì±„ë„ ì† ìˆ¨ì€ ê³ ì–‘ì´ë¥¼ ì°¾ì•„ë¼!</p>

            <!-- ê²Œì„ ë£° ì„¤ëª… -->
            <div class="rules-section">
                <h3>ê²Œì„ ë°©ë²•</h3>

                <div class="rule-item">
                    <div class="rule-number">1</div>
                    <div class="rule-content">
                        <h4>ì°¸ì—¬ ì¸ì› ì„ íƒ</h4>
                        <p>2ëª…ë¶€í„° 15ëª…ê¹Œì§€ í•¨ê»˜ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>

                <div class="rule-item">
                    <div class="rule-number">2</div>
                    <div class="rule-content">
                        <h4>ì´ë¦„ ì…ë ¥ & ì±„ë„ ì„ íƒ</h4>
                        <p>í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ê³ , 1~999ë²ˆ ì¤‘ ì›í•˜ëŠ” ì±„ë„ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                    </div>
                </div>

                <div class="rule-item">
                    <div class="rule-number">3</div>
                    <div class="rule-content">
                        <h4>ê³ ì–‘ì´ ì°¾ê¸°</h4>
                        <p>ì±„ë„ ë³€ê²½ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í™”ë©´ì— ì´ë¯¸ì§€ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. í™”ë©´ì„ ìŠ¤ìº”í•˜ë©° ìˆ¨ì–´ìˆëŠ” <strong>ê³ ì–‘ì´ì˜ ìˆ˜</strong>ë¥¼ ìë™ìœ¼ë¡œ ì„¸ì–´ì¤ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <div class="rule-item">
                    <div class="rule-number">4</div>
                    <div class="rule-content">
                        <h4>ìŠ¹ì ê²°ì •</h4>
                        <p>ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì°¨ë¡€ë¥¼ ë§ˆì¹˜ë©´, <strong>ê°€ì¥ ë§ì€ ê³ ì–‘ì´ë¥¼ ì°¾ì€ ì‚¬ëŒ</strong>ì´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤!</p>
                    </div>
                </div>

                <div class="rule-item">
                    <div class="rule-number">5</div>
                    <div class="rule-content">
                        <h4>ì´ë¦„ ë³€ê²½</h4>
                        <p>ê° í”Œë ˆì´ì–´ ë³„ë¡œ <strong>ì´ë¦„ì„ ë³€ê²½</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- íŒ ì„¹ì…˜ -->
            <div class="tips-section">
                <h3>ê³ ì–‘ì´ ì¹´ìš´íŠ¸ ì¡°ê±´</h3>
                <ul>
                    <li>ì´ëª©êµ¬ë¹„(ëˆˆ,ì½”,ì…)ê°€ ì¸ì‹ë˜ë„ë¡ ì˜ ë‚˜ì˜¨ ê²½ìš°ë§Œ ì¹´ìš´íŠ¸ ë©ë‹ˆë‹¤.</li>
                    <li>ê³ ì–‘ì´ ì´ì™¸ì˜ ë‹¤ë¥¸ ë™ë¬¼ë“¤ì€ ì¹´ìš´íŠ¸ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                    <li>ìŠ¤ìº” ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</li>
                </ul>
            </div>

            <!-- íšŒì‚¬ ì •ë³´ -->
            <div class="company-info">
                <p>Â© 2025 CODA Creative. All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ Alert íŒì—… -->
    <div class="custom-alert-overlay" id="customAlertOverlay" onclick="closeCustomAlert()">
        <div class="custom-alert-popup" onclick="event.stopPropagation()">
            <div class="custom-alert-message" id="customAlertMessage"></div>
            <button class="custom-alert-button" onclick="closeCustomAlert()">í™•ì¸</button>
        </div>
    </div>

    <!-- ë°°ê²½ ìŒì•… -->
    <audio id="bgMusic">
        <source id="bgMusicSrc" src="audio/background-music.mp3" type="audio/mpeg">
    </audio>

    <!-- ìŠ¤ìº” íš¨ê³¼ìŒ -->
    <audio id="scanSound">
        <source src="audio/scan.mp3" type="audio/mpeg">
    </audio>

    <!-- ê³ ì–‘ì´ ë°œê²¬ íš¨ê³¼ìŒ (ì—¬ëŸ¬ ê°œ ë™ì‹œ ì¬ìƒì„ ìœ„í•œ í’€) -->
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>
    <audio class="catSound">
        <source src="audio/small_cat_sound.mp3" type="audio/mpeg">
    </audio>

    <!-- í´ë¦­ íš¨ê³¼ìŒ -->
    <audio id="clickSound">
        <source src="audio/click.mp3" type="audio/mpeg">
    </audio>

    <!-- ì‹¤íŒ¨ íš¨ê³¼ìŒ -->
    <audio id="failSound">
        <source src="audio/fail.mp3" type="audio/mpeg">
    </audio>

    <!-- ê²Œì„ ì‹œì‘ íš¨ê³¼ìŒ -->
    <audio id="gameStartSound">
        <source src="audio/game_start.mp3" type="audio/mpeg">
    </audio>

    <!-- ê²Œì„ ì¢…ë£Œ íš¨ê³¼ìŒ -->
    <audio id="gameEndSound">
        <source src="audio/game_end.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== ì„¤ì • ====================
        const MAX_CHANNEL_IMAGES = 72;

        // ==================== ê²Œì„ ë°ì´í„° ====================
        const channelImages = [];
        for (let i = 1; i <= MAX_CHANNEL_IMAGES; i++) {
            const paddedNum = String(i).padStart(4, '0');
            channelImages.push(`channel${paddedNum}.png`);
        }

        // ê¸°ë³¸ í”Œë ˆì´ì–´ ì´ë¦„ (20ê°œ)
        const DEFAULT_PLAYER_NAMES = [
            'ëƒ¥ì½©ì´', 'ëª½ê¸€ëƒ¥', 'ê³ ì–‘ë³„', 'ëƒ¥ë­‰ì¹˜', 'ê¼¬ë¬¼ì´',
            'ë§ë‘ë°œë°”ë‹¥', 'ì†œë°œì´', 'ì½”ì½”ëƒ¥', 'ë³„ëƒ¥ì´', 'êµ¬ë¦„ë°œìêµ­',
            'ì‚´ë‘ì´', 'ì´ˆì½”ê¼¬ë¦¬', 'ë™ê¸€ëƒ¥', 'í•˜ëŠ˜ë°œìêµ­', 'ë‹¬ëƒ¥ì´',
            'ìˆœë‘¥ëƒ¥', 'ëˆˆì†¡ì´ëƒ¥', 'í¬í¬ëƒ¥', 'ê°€ì„ëƒ¥', 'ì´ì´ì´'
        ];

        // ê³ ì–‘ì´ ì‚¬ìš´ë“œ í’€ ì´ˆê¸°í™”
        const catSoundPool = Array.from(document.querySelectorAll('.catSound'));
        let currentCatSoundIndex = 0;

        // ==================== ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ë¡œì§ ====================
        const customDropdown = document.getElementById('customDropdown');
        const dropdownButton = document.getElementById('dropdownButton');
        const dropdownList = document.getElementById('dropdownList');
        const dropdownValue = document.getElementById('dropdownValue');
        const nativeSelect = document.getElementById('playerCount');

        // ë“œë¡­ë‹¤ìš´ í† ê¸€
        if (dropdownButton) {
            dropdownButton.addEventListener('click', (e) => {
                e.stopPropagation();
                customDropdown.classList.toggle('open');
            });
        }

        // ì˜µì…˜ ì„ íƒ
        if (dropdownList) {
            dropdownList.addEventListener('click', (e) => {
                if (e.target.classList.contains('custom-dropdown-option')) {
                    const value = e.target.getAttribute('data-value');
                    const text = e.target.textContent;

                    // ì„ íƒëœ ì˜µì…˜ í‘œì‹œ
                    dropdownValue.textContent = text;

                    // ë„¤ì´í‹°ë¸Œ select ë™ê¸°í™”
                    nativeSelect.value = value;

                    // ì„ íƒëœ ì˜µì…˜ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                    document.querySelectorAll('.custom-dropdown-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    e.target.classList.add('selected');

                    // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    customDropdown.classList.remove('open');
                }
            });
        }

        // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', () => {
            if (customDropdown) {
                customDropdown.classList.remove('open');
            }
        });

        // ì´ˆê¸° ì„ íƒëœ ì˜µì…˜ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            const selectedOption = document.querySelector('.custom-dropdown-option[data-value="3"]');
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
        });

        let totalPlayers = 3;
        let currentPlayerIndex = 0;
        let currentChannel = '';
        let currentImage = '';
        let players = [];
        let catPositions = {};
        let usedImages = [];

        // ==================== ì´ë¦„ ìœ íš¨ì„± ê²€ì‚¬ ====================
        function validatePlayerName(name) {
            if (!name || name.trim() === '') {
                return { valid: false, message: 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!' };
            }

            const trimmedName = name.trim();
            const validCharsRegex = /^[ê°€-í£a-zA-Z0-9]+$/;
            if (!validCharsRegex.test(trimmedName)) {
                return { valid: false, message: 'í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!' };
            }

            const koreanChars = trimmedName.match(/[ê°€-í£]/g) || [];
            const otherChars = trimmedName.match(/[a-zA-Z0-9]/g) || [];

            if (koreanChars.length > 0) {
                const totalLength = koreanChars.length + otherChars.length;
                if (totalLength < 2 || totalLength > 10) {
                    return { valid: false, message: 'í•œê¸€ í¬í•¨ ì‹œ 2~10ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!' };
                }
            } else {
                if (otherChars.length < 2 || otherChars.length > 20) {
                    return { valid: false, message: 'ì˜ë¬¸/ìˆ«ìë§Œ ì‚¬ìš© ì‹œ 2~20ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!' };
                }
            }

            return { valid: true, message: '' };
        }

        // ==================== ì´ˆê¸°í™” ====================
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('point/json/pointInfo.json');
                if (response.ok) {
                    catPositions = await response.json();
                    console.log('ê³ ì–‘ì´ ìœ„ì¹˜ ì •ë³´ ë¡œë“œ ì™„ë£Œ');
                }
            } catch (error) {
                console.warn('ê³ ì–‘ì´ ìœ„ì¹˜ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        });

        // ==================== ë°°ê²½ ìŒì•… í† ê¸€ ====================
        let isMusicPlaying = false;

        // ==================== ë°°ê²½ ìŒì•… ë£¨í”„ ì•ˆì „ ì²˜ë¦¬ ====================
        const bgMusic = document.getElementById('bgMusic');
        const bgMusicSrc = document.getElementById('bgMusicSrc');

        if (bgMusic) {
            // loop ì†ì„± ëŒ€ì‹  JSë¡œ ë£¨í”„ ì²˜ë¦¬
            bgMusic.addEventListener('ended', () => {
                if (isMusicPlaying) {
                    // ëŠê¹€ ë°©ì§€ìš©ìœ¼ë¡œ ì‚´ì§ ì—¬ìœ ë¥¼ ë‘ê³  ë‹¤ì‹œ ì‹œì‘í•´ë„ ë˜ê³ ,
                    // ê·¸ëƒ¥ 0ìœ¼ë¡œ ëŒë ¤ë„ ë¨
                    bgMusic.currentTime = 0;
                    bgMusic.play().catch(err => {
                        console.warn('ë°°ê²½ìŒ ë£¨í”„ ì¬ìƒ ì‹¤íŒ¨:', err);
                    });
                }
            });
        }


        function toggleMusic() {
            const bgMusic = document.getElementById('bgMusic');
            const bgMusicSrc = document.getElementById('bgMusicSrc');
            const powerButton = document.getElementById('powerButton');
            const ledIndicator = document.getElementById('ledIndicator');
            const soundWaves = document.getElementById('soundWaves');

            if (isMusicPlaying) {
                // ìŒì•… ë„ê¸°
                bgMusic.pause();
                powerButton.classList.remove('active');
                ledIndicator.classList.remove('active');
                soundWaves.classList.remove('active');
                isMusicPlaying = false;
            } else {
                // ì‹œê°ì  íš¨ê³¼ ë¨¼ì € í™œì„±í™” (ìŒì•… íŒŒì¼ ì—†ì–´ë„ ì‘ë™)
                powerButton.classList.add('active');
                ledIndicator.classList.add('active');
                soundWaves.classList.add('active');
                isMusicPlaying = true;

                // ìŒì•… ì¬ìƒ ì‹œë„ (íŒŒì¼ì´ ìˆìœ¼ë©´ ì¬ìƒ, ì—†ìœ¼ë©´ ë¬´ì‹œ)
                if (bgMusicSrc && bgMusicSrc.src) {
                    bgMusic.play()
                        .catch(error => {
                            console.warn('ìŒì•… ì¬ìƒ ì‹¤íŒ¨ (ì •ìƒ - ìŒì•… íŒŒì¼ì´ ì—†ê±°ë‚˜ ë¸Œë¼ìš°ì € ì •ì±…):', error);
                            // ì‹œê°ì  íš¨ê³¼ëŠ” ìœ ì§€
                        });
                } else {
                    console.info('ë°°ê²½ ìŒì•… íŒŒì¼ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‹œê°ì  íš¨ê³¼ë§Œ í‘œì‹œë©ë‹ˆë‹¤.');
                }
            }
        }

        // ==================== ê²Œì„ ì •ë³´ íŒì—… ====================
        function openInfoPopup() {
            const popup = document.getElementById('infoPopup');
            popup.classList.add('active');
            document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        }

        function closeInfoPopup() {
            const popup = document.getElementById('infoPopup');
            popup.classList.remove('active');
            document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µì›
        }

        // ==================== ì»¤ìŠ¤í…€ Alert íŒì—… ====================
        function showCustomAlert(message) {
            const overlay = document.getElementById('customAlertOverlay');
            const messageEl = document.getElementById('customAlertMessage');
            messageEl.textContent = message;
            overlay.classList.add('active');
        }

        function closeCustomAlert() {
            const overlay = document.getElementById('customAlertOverlay');
            overlay.classList.remove('active');
        }

        // ==================== ê³ ì–‘ì´ ë°œìêµ­ ì• ë‹ˆë©”ì´ì…˜ ====================
        function createPawPrint(x, y, rotation = 0) {
            // TV ì˜ì—­ ì²´í¬
            const tvScreen = document.querySelector('.tv-screen');
            if (tvScreen) {
                const tvRect = tvScreen.getBoundingClientRect();
                const pawSize = 50; // ë°œìêµ­ í¬ê¸°

                // ë°œìêµ­ì´ TV ì˜ì—­ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
                if (x + pawSize > tvRect.left &&
                    x < tvRect.right &&
                    y + pawSize > tvRect.top &&
                    y < tvRect.bottom) {
                    return; // TV ì˜ì—­ì´ë©´ ë°œìêµ­ ìƒì„± ì•ˆí•¨
                }
            }

            const container = document.getElementById('pawPrintsContainer');
            const paw = document.createElement('div');
            paw.className = 'paw-print';
            paw.style.left = `${x}px`;
            paw.style.top = `${y}px`;
            paw.style.transform = `rotate(${rotation}deg) scaleX(-1)`;

            container.appendChild(paw);

            // ì• ë‹ˆë©”ì´ì…˜ ëë‚˜ë©´ ì œê±°
            setTimeout(() => {
                paw.remove();
            }, 8000);
        }

        // ==================== ê³ ì–‘ì´ ë°œìêµ­ ì• ë‹ˆë©”ì´ì…˜ (ì—°ì† ê±·ê¸°) ====================
        let catPosition = { x: 0, y: 0 };
        let catAngle = 0;
        let isWalking = false;

        function initializeCatPosition() {
            // í™”ë©´ ì¤‘ì•™ ê·¼ì²˜ì—ì„œ ì‹œì‘
            catPosition.x = window.innerWidth / 2 + (Math.random() - 0.5) * 200;
            catPosition.y = window.innerHeight / 2 + (Math.random() - 0.5) * 200;
            catAngle = Math.random() * 360;
        }

        function getNextDirection() {
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const margin = 100;

            // í™”ë©´ ê°€ì¥ìë¦¬ì— ê°€ê¹Œìš°ë©´ ì•ˆìª½ìœ¼ë¡œ ë°©í–¥ ì „í™˜
            if (catPosition.x < margin) {
                catAngle = -45 + Math.random() * 90; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ
            } else if (catPosition.x > screenWidth - margin) {
                catAngle = 135 + Math.random() * 90; // ì™¼ìª½ìœ¼ë¡œ
            } else if (catPosition.y < margin) {
                catAngle = 45 + Math.random() * 90; // ì•„ë˜ìª½ìœ¼ë¡œ
            } else if (catPosition.y > screenHeight - margin) {
                catAngle = 225 + Math.random() * 90; // ìœ„ìª½ìœ¼ë¡œ
            } else {
                // í™”ë©´ ì¤‘ì•™ì—ì„œëŠ” ììœ ë¡­ê²Œ ë°©í–¥ ë³€ê²½ (-45ë„ ~ +45ë„)
                catAngle += (Math.random() - 0.5) * 90;
            }

            // ê°ë„ ì •ê·œí™” (0-360)
            catAngle = ((catAngle % 360) + 360) % 360;
        }

        function createContinuousPawTrail() {
            const pawCount = 8; // ê³ ì •ëœ ë°œìêµ­ ê°œìˆ˜
            const stepSize = 45; // ë°œìêµ­ ê°„ê²©
            const stepWidth = 12; // ì¢Œìš° ê°„ê²©

            // ìƒˆë¡œìš´ ë°©í–¥ ê²°ì •
            getNextDirection();

            const rad = (catAngle * Math.PI) / 180;

            // ë°œìêµ­ ìƒì„±
            for (let i = 0; i < pawCount; i++) {
                setTimeout(() => {
                    // ì¢Œìš° êµëŒ€ë¡œ ë°œìêµ­ ì°ê¸°
                    const side = (i % 2 === 0) ? -1 : 1;
                    const offsetX = Math.cos(rad) * stepSize * i + Math.sin(rad) * stepWidth * side;
                    const offsetY = Math.sin(rad) * stepSize * i - Math.cos(rad) * stepWidth * side;

                    const x = catPosition.x + offsetX;
                    const y = catPosition.y + offsetY;

                    // ë°œìêµ­ íšŒì „ (ì´ë™ ë°©í–¥ì— ë§ì¶¤ + 90ë„)
                    const rotation = catAngle + 90 + (Math.random() - 0.5) * 10;

                    createPawPrint(x, y, rotation);

                    // ë§ˆì§€ë§‰ ë°œìêµ­ì—ì„œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                    if (i === pawCount - 1) {
                        catPosition.x = x;
                        catPosition.y = y;
                    }
                }, i * 250); // 0.25ì´ˆ ê°„ê²©ìœ¼ë¡œ ë°œìêµ­ ìƒì„±
            }
        }

        // ì—°ì†ì ìœ¼ë¡œ ë°œìêµ­ ìƒì„±
        function startContinuousWalking() {
            if (!isWalking) {
                initializeCatPosition();
                isWalking = true;
            }

            createContinuousPawTrail();

            // ë‹¤ìŒ ê²½ë¡œ ì‹œì‘ (í˜„ì¬ ê²½ë¡œê°€ ëë‚˜ê¸° ì „ì— ì‹œì‘)
            setTimeout(startContinuousWalking, 1800); // 8ê°œ * 250ms = 2000msë³´ë‹¤ ì¡°ê¸ˆ ë¹¨ë¦¬
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ë°œìêµ­ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(startContinuousWalking, 2000); // 2ì´ˆ í›„ ì‹œì‘
        });

        // ==================== ì•± ìƒëª…ì£¼ê¸° ê´€ë¦¬ (ë°±ê·¸ë¼ìš´ë“œ/í¬ê·¸ë¼ìš´ë“œ) ====================
        let resumeTimer = null;
        document.addEventListener('visibilitychange', () => {
            const bgMusic = document.getElementById('bgMusic');
            const scanSound = document.getElementById('scanSound');
            const gameStartSound = document.getElementById('gameStartSound');
            const gameEndSound = document.getElementById('gameEndSound');
            const failSound = document.getElementById('failSound');

            if (!bgMusic) return;

            if (document.hidden) {
                if (resumeTimer) {
                    clearTimeout(resumeTimer);
                    resumeTimer = null;
                }

                // ì•±ì´ ë°±ê·¸ë¼ìš´ë“œë¡œ ê°”ì„ ë•Œ - ëª¨ë“  ì˜¤ë””ì˜¤ ì¼ì‹œì •ì§€
                window.wasMusicPlaying = !bgMusic.paused;
                bgMusic.pause();

                scanSound.pause();
                gameStartSound.pause();
                gameEndSound.pause();
                failSound.pause();

                console.log('ì•± ë°±ê·¸ë¼ìš´ë“œ - ëª¨ë“  ì˜¤ë””ì˜¤ ì¼ì‹œì •ì§€');
            } else {
                console.log('ì•± í¬ê·¸ë¼ìš´ë“œ ë³µê·€');

                // ë°°ê²½ìŒì•…ì´ ì¬ìƒ ì¤‘ì´ì—ˆë‹¤ë©´ "ê¹¨ë—í•˜ê²Œ" ì¬ì‹œì‘
                if (window.wasMusicPlaying && isMusicPlaying) {
                    // 200ms ì •ë„ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì¬ìƒ ì‹œë„ (ë ˆì´ì•„ì›ƒ/ë·°í¬íŠ¸ ì•ˆì •í™” í›„)
                    resumeTimer = setTimeout(() => {
                        try {
                            bgMusic.currentTime = 0; // í˜¹ì€ ê¸°ì¡´ ìœ„ì¹˜ ìœ ì§€ë„ ê°€ëŠ¥
                            bgMusic.play()
                                .then(() => console.log('ë°°ê²½ìŒ ìë™ ì¬ê°œ'))
                                .catch(err => console.warn('ë°°ê²½ìŒ ìë™ ì¬ê°œ ì‹¤íŒ¨:', err));
                        } catch (e) {
                            console.warn('ë°°ê²½ìŒ ìë™ ì¬ê°œ ì¤‘ ì˜¤ë¥˜:', e);
                        }
                    }, 200);
                }
            }
        });

        // ==================== í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë ˆì´ì•„ì›ƒ ê°•ì œ ì—…ë°ì´íŠ¸ (Safe Area ëŒ€ì‘) ====================
        // ë¸Œë¼ìš°ì €(WebView)ê°€ ì œê³µí•˜ëŠ” ì•ˆì „ ì˜ì—­(insets)ì—ë§Œ ë§¡ê¹ë‹ˆë‹¤.

        // ==================== ê²Œì„ ì‹œì‘ ====================
        function startGame() {
            // ê²Œì„ ì‹œì‘ ì‚¬ìš´ë“œ ì¬ìƒ
            const gameStartSound = document.getElementById('gameStartSound');
            gameStartSound.currentTime = 0;
            gameStartSound.play().catch(error => console.warn('ê²Œì„ ì‹œì‘ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));

            totalPlayers = parseInt(document.getElementById('playerCount').value);
            currentPlayerIndex = 0;
            players = [];
            usedImages = [];

            document.getElementById('initialScreen').classList.add('slide-out');
            setTimeout(() => {
                document.getElementById('initialScreen').classList.add('hidden');
                const remoteControl = document.getElementById('remoteControl');
                remoteControl.style.display = 'block';
                remoteControl.classList.add('slide-in');
                updatePlayerInfo();
                setDefaultPlayerName();
            }, 500);
        }

        // ==================== ê¸°ë³¸ í”Œë ˆì´ì–´ ì´ë¦„ ì„¤ì • ====================
        function setDefaultPlayerName() {
            const nameInput = document.getElementById('playerName');
            if (currentPlayerIndex < DEFAULT_PLAYER_NAMES.length) {
                nameInput.value = DEFAULT_PLAYER_NAMES[currentPlayerIndex];
            } else {
                nameInput.value = `í”Œë ˆì´ì–´${currentPlayerIndex + 1}`;
            }
        }

        // ==================== í”Œë ˆì´ì–´ ì •ë³´ ì—…ë°ì´íŠ¸ ====================
        function updatePlayerInfo() {
            const playerInfo = document.getElementById('playerInfo');
            playerInfo.textContent = `í”Œë ˆì´ì–´ ${currentPlayerIndex + 1} / ${totalPlayers}`;
        }

        // ==================== ë¦¬ëª¨ì»¨ ê¸°ëŠ¥ ====================
        function pressNumber(num) {
            const btn = window.event ? window.event.target : event.target;
            btn.classList.add('pressed');
            setTimeout(() => btn.classList.remove('pressed'), 200);

            // ì²« ìë¦¬ì— 0ì„ ì…ë ¥í•˜ì§€ ëª»í•˜ë„ë¡ ë°©ì§€
            if (currentChannel.length === 0 && num === '0') {
                return;
            }

            if (currentChannel.length < 3) {
                currentChannel += num;
                updateChannelDisplay();
            }
        }

        function backspace() {
            currentChannel = currentChannel.slice(0, -1);
            updateChannelDisplay();
        }

        function updateChannelDisplay() {
            const display = document.getElementById('channelDisplay');
            if (currentChannel.length > 0) {
                display.textContent = currentChannel.padStart(3, '0');
                display.classList.add('active');
            } else {
                display.textContent = '000';
                display.classList.remove('active');
            }
        }

        // ==================== ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” ====================
        function setNumberPadEnabled(enabled) {
            const buttons = ['btn1', 'btn2', 'btn3', 'btn4', 'btn5', 'btn6', 'btn7', 'btn8', 'btn9', 'btn0', 'btnBackspace', 'btnChannel'];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = !enabled;
            });
        }

        function setNextButtonEnabled(enabled) {
            document.getElementById('btnNext').disabled = !enabled;
        }

        // ==================== ë‹¤ìŒ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ====================
        function updateNextButtonText() {
            const btnNext = document.getElementById('btnNext');
            if (currentPlayerIndex === totalPlayers - 1) {
                btnNext.textContent = 'ê²°ê³¼ í™•ì¸';
            } else {
                btnNext.textContent = 'ë‹¤ìŒ';
            }
        }

        // ==================== ì¹´ìš´í„° ì—…ë°ì´íŠ¸ (íŒ¡ íš¨ê³¼ - ìˆ«ìë§Œ) ====================
        function updateCatCounter(count) {
            const counter = document.getElementById('catCounter');
            counter.textContent = count;
            counter.classList.add('active');

            // íŒ¡ íš¨ê³¼
            counter.classList.remove('pop');
            void counter.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œ
            counter.classList.add('pop');
        }

        // ==================== ì±„ë„ ë³€ê²½ ====================
        function changeChannel() {
            const channelNum = parseInt(currentChannel);

            if (!currentChannel || channelNum < 1 || channelNum > 999) {
                showCustomAlert('ì±„ë„ ë²ˆí˜¸ëŠ” 1~999 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ì´ë¯¸ ì‚¬ìš©ëœ ì±„ë„ ë²ˆí˜¸ì¸ì§€ í™•ì¸
            const usedChannels = players.map(p => p.channel);
            if (usedChannels.includes(currentChannel.padStart(3, '0'))) {
                showCustomAlert(`ì±„ë„ ${currentChannel.padStart(3, '0')}ë²ˆì€ ì´ë¯¸ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì‚¬ìš©ëœ ì±„ë„: ${usedChannels.join(', ')}`);
                return;
            }

            const availableImages = channelImages.filter(img => !usedImages.includes(img));

            if (availableImages.length === 0) {
                showCustomAlert('ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë¯¸ì§€ê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!');
                return;
            }

            const randomIndex = Math.floor(Math.random() * availableImages.length);
            currentImage = availableImages[randomIndex];

            const tvImage = document.getElementById('tvImage');
            tvImage.src = `images/channels/${currentImage}`;
            tvImage.style.display = 'block';

            tvImage.onload = () => {
                displayCatScanAnimation(currentImage);
                setNumberPadEnabled(false);
            };

            tvImage.onerror = () => {
                showCustomAlert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                tvImage.style.display = 'none';
            };
        }

        // ==================== ìŠ¤ìº” ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ê³ ì–‘ì´ ê°ì§€ í‘œì‹œ ====================
        function displayCatScanAnimation(imageName) {
            // ê¸°ì¡´ í„ìŠ¤ì™€ ìŠ¤ìº” ë¼ì¸ ì œê±°
            const existingPulses = document.querySelectorAll('.cat-pulse');
            existingPulses.forEach(pulse => pulse.remove());

            const existingScanLine = document.querySelector('.scan-line');
            if (existingScanLine) existingScanLine.remove();

            if (!catPositions[imageName]) {
                console.warn(`${imageName}ì— ëŒ€í•œ ê³ ì–‘ì´ ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }

            const cats = catPositions[imageName].cats;
            const tvScreen = document.getElementById('tvScreen');

            // ì¹´ìš´í„° ì´ˆê¸°í™” ë° í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜ ì—†ì´)
            const counter = document.getElementById('catCounter');
            counter.textContent = 0;
            counter.classList.add('active');

            // ìŠ¤ìº” ë¼ì¸ ìƒì„±
            const scanLine = document.createElement('div');
            scanLine.className = 'scan-line';
            tvScreen.appendChild(scanLine);

            // ìŠ¤ìº” ì‚¬ìš´ë“œ ì¬ìƒ
            const scanSound = document.getElementById('scanSound');
            scanSound.currentTime = 0;
            scanSound.play().catch(error => console.warn('ìŠ¤ìº” ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));

            let detectedCount = 0;

            // ê° ê³ ì–‘ì´ ìœ„ì¹˜ì— í„ìŠ¤ íš¨ê³¼ ì¶”ê°€ (ìŠ¤ìº” ë¼ì¸ì´ ì§€ë‚˜ê°ˆ ë•Œ)
            cats.forEach((cat, index) => {
                // ìŠ¤ìº” ë¼ì¸ì´ í•´ë‹¹ ìœ„ì¹˜ì— ë„ë‹¬í•˜ëŠ” ì‹œê°„ ê³„ì‚° (2ì´ˆ ë™ì•ˆ 0%ì—ì„œ 100%ë¡œ ì´ë™)
                const delay = cat.x * 2000; // x ì¢Œí‘œì— ë¹„ë¡€í•œ ë”œë ˆì´ (ë°€ë¦¬ì´ˆ)

                setTimeout(() => {
                    const pulse = document.createElement('div');
                    pulse.className = 'cat-pulse';
                    pulse.style.left = `${cat.x * 100}%`;
                    pulse.style.top = `${cat.y * 100}%`;
                    tvScreen.appendChild(pulse);

                    // ì¹´ìš´í„° ì¦ê°€ (íŒ¡ íš¨ê³¼)
                    detectedCount++;
                    updateCatCounter(detectedCount);

                    // ê³ ì–‘ì´ ë°œê²¬ ì‚¬ìš´ë“œ ì¬ìƒ (ì˜¤ë””ì˜¤ í’€ ì‚¬ìš©)
                    const catSound = catSoundPool[currentCatSoundIndex];
                    catSound.currentTime = 0;
                    catSound.play().catch(error => console.warn('ê³ ì–‘ì´ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));

                    // ë‹¤ìŒ ì˜¤ë””ì˜¤ ìš”ì†Œë¡œ ìˆœí™˜
                    currentCatSoundIndex = (currentCatSoundIndex + 1) % catSoundPool.length;

                    // í”Œë¡œíŒ… ìˆ«ì í‘œì‹œ ì œê±°ë¨

                    // í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ ì œê±°
                    setTimeout(() => {
                        pulse.remove();
                    }, 1500);
                }, delay);
            });

            // ìŠ¤ìº” ë¼ì¸ ì œê±° ë° ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            setTimeout(() => {
                scanLine.remove();

                // ê³ ì–‘ì´ê°€ 0ë§ˆë¦¬ë©´ ì‹¤íŒ¨ ì‚¬ìš´ë“œ ì¬ìƒ
                if (detectedCount === 0) {
                    const failSound = document.getElementById('failSound');
                    failSound.currentTime = 0;
                    failSound.play().catch(error => console.warn('ì‹¤íŒ¨ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));
                }

                setNextButtonEnabled(true);
                updateNextButtonText();
            }, 2000);
        }

        // ==================== í”Œë ˆì´ì–´ í™•ì • ====================
        function confirmPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const channelNum = parseInt(currentChannel);

            const validation = validatePlayerName(name);
            if (!validation.valid) {
                showCustomAlert(validation.message);
                return;
            }

            if (!currentChannel || channelNum < 1 || channelNum > 999) {
                showCustomAlert('ì±„ë„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”! (1~999)');
                return;
            }

            if (!currentImage) {
                showCustomAlert('ì±„ë„ë³€ê²½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë¯¸ì§€ë¥¼ ë¨¼ì € í‘œì‹œí•´ì£¼ì„¸ìš”!');
                return;
            }

            // ë²„íŠ¼ ì‚¬ìš´ë“œ ì¬ìƒ (ë§ˆì§€ë§‰ í”Œë ˆì´ì–´ë©´ game_end, ì•„ë‹ˆë©´ click)
            if (currentPlayerIndex === totalPlayers - 1) {
                // ê²°ê³¼ í™•ì¸ ë²„íŠ¼
                const gameEndSound = document.getElementById('gameEndSound');
                gameEndSound.currentTime = 0;
                gameEndSound.play().catch(error => console.warn('ê²Œì„ ì¢…ë£Œ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));
            } else {
                // ë‹¤ìŒ ë²„íŠ¼
                const clickSound = document.getElementById('clickSound');
                clickSound.currentTime = 0;
                clickSound.play().catch(error => console.warn('í´ë¦­ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error));
            }

            const catCount = getCatCount(currentImage);

            players.push({
                name: name,
                channel: currentChannel.padStart(3, '0'),
                catCount: catCount,
                imageName: currentImage
            });

            usedImages.push(currentImage);
            currentPlayerIndex++;

            if (currentPlayerIndex < totalPlayers) {
                resetForNextPlayer();
            } else {
                showResults();
            }
        }

        // ==================== ë‹¤ìŒ í”Œë ˆì´ì–´ ì¤€ë¹„ ====================
        function resetForNextPlayer() {
            currentChannel = '';
            currentImage = '';

            const tvImage = document.getElementById('tvImage');
            tvImage.style.display = 'none';

            // í„ìŠ¤ì™€ ìŠ¤ìº” ë¼ì¸ ì œê±°
            const existingPulses = document.querySelectorAll('.cat-pulse');
            existingPulses.forEach(pulse => pulse.remove());

            const existingScanLine = document.querySelector('.scan-line');
            if (existingScanLine) existingScanLine.remove();

            // ì¹´ìš´í„° ìˆ¨ê¸°ê¸°
            const counter = document.getElementById('catCounter');
            counter.classList.remove('active', 'pop');

            updateChannelDisplay();
            updatePlayerInfo();
            setDefaultPlayerName();
            setNumberPadEnabled(true);
            setNextButtonEnabled(false);
        }

        // ==================== ê³ ì–‘ì´ ê°œìˆ˜ ê³„ì‚° ====================
        function getCatCount(imageName) {
            if (catPositions[imageName] && catPositions[imageName].cats) {
                return catPositions[imageName].cats.length;
            }
            return 0;
        }

        // ==================== ê²°ê³¼ í‘œì‹œ (ìˆ˜ì •ëœ ê³µë™ ë“±ìˆ˜ ì²˜ë¦¬ + ì¸ë„¤ì¼) ====================
        function showResults() {
            players.sort((a, b) => b.catCount - a.catCount);

            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';

            // ê° ì ìˆ˜ë³„ í”Œë ˆì´ì–´ ìˆ˜ ì¹´ìš´íŠ¸
            const scoreCount = {};
            players.forEach(player => {
                scoreCount[player.catCount] = (scoreCount[player.catCount] || 0) + 1;
            });

            let currentRank = 1;
            let previousCount = -1;

            players.forEach((player, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';

                // ë“±ìˆ˜ ì—…ë°ì´íŠ¸
                if (player.catCount !== previousCount) {
                    currentRank = index + 1;
                }
                previousCount = player.catCount;

                // ê°™ì€ ì ìˆ˜ë¥¼ ê°€ì§„ í”Œë ˆì´ì–´ê°€ 2ëª… ì´ìƒì¸ì§€ í™•ì¸
                const isTied = scoreCount[player.catCount] > 1;

                let rankClass = '';
                let rankEmoji = '';
                let rankText = '';

                if (currentRank === 1) {
                    rankClass = 'first';
                    rankEmoji = 'ğŸ¥‡';
                    rankText = isTied ? 'ê³µë™ 1ë“±' : '1ë“±';
                } else if (currentRank === 2) {
                    rankClass = 'second';
                    rankEmoji = 'ğŸ¥ˆ';
                    rankText = isTied ? 'ê³µë™ 2ë“±' : '2ë“±';
                } else if (currentRank === 3) {
                    rankClass = 'third';
                    rankEmoji = 'ğŸ¥‰';
                    rankText = isTied ? 'ê³µë™ 3ë“±' : '3ë“±';
                } else {
                    rankText = isTied ? `ê³µë™ ${currentRank}ë“±` : `${currentRank}ë“±`;
                }

                resultItem.innerHTML = `
                    <div class="result-rank ${rankClass}">
                        ${rankEmoji ? `<span class="rank-emoji">${rankEmoji}</span>` : ''}
                        <span class="rank-text">${rankText}</span>
                    </div>
                    <div class="result-info">
                        <div class="result-name">${player.name}</div>
                        <div class="result-details">
                            <span class="result-channel">ì±„ë„ ${player.channel}</span>
                            <span class="result-score">ğŸ± ${player.catCount}ë§ˆë¦¬</span>
                        </div>
                    </div>
                    <div class="result-thumbnail">
                        <img src="images/channels/${player.imageName}" alt="ì±„ë„ ${player.channel}">
                    </div>
                `;

                resultList.appendChild(resultItem);
            });

            document.getElementById('remoteControl').style.display = 'none';
            document.getElementById('resultScreen').classList.add('active');
        }

        // ==================== ê²Œì„ ë¦¬ì…‹ ====================
        function resetGame() {
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™” (ìŒì•…ì€ ìœ ì§€)
            totalPlayers = 3;
            currentPlayerIndex = 0;
            currentChannel = '';
            currentImage = '';
            players = [];
            usedImages = [];

            // UI ì´ˆê¸°í™”
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('remoteControl').style.display = 'none';
            document.getElementById('remoteControl').classList.remove('slide-in');
            document.getElementById('initialScreen').classList.remove('slide-out', 'hidden');

            // TV í™”ë©´ ì´ˆê¸°í™”
            const tvImage = document.getElementById('tvImage');
            tvImage.style.display = 'none';
            tvImage.src = '';
            tvImage.onload = null;
            tvImage.onerror = null;

            // ì¹´ìš´í„° ì´ˆê¸°í™”
            const counter = document.getElementById('catCounter');
            counter.classList.remove('active', 'pop');
            counter.textContent = '0';

            // ì±„ë„ ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            const channelDisplay = document.getElementById('channelDisplay');
            channelDisplay.classList.remove('active');
            channelDisplay.textContent = '000';

            // í”Œë ˆì´ì–´ ìˆ˜ ì„ íƒ ì´ˆê¸°í™”
            document.getElementById('playerCount').value = '3';

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('playerName').value = '';

            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            setNumberPadEnabled(true);
            setNextButtonEnabled(false);

            // í„ìŠ¤ì™€ ìŠ¤ìº” ë¼ì¸ ì œê±°
            const existingPulses = document.querySelectorAll('.cat-pulse');
            existingPulses.forEach(pulse => pulse.remove());

            const existingScanLine = document.querySelector('.scan-line');
            if (existingScanLine) existingScanLine.remove();
        }
    </script>
</body>

</html>